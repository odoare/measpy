 <!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>measpy - Measurements with Python &mdash; measpy  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="GNU LESSER GENERAL PUBLIC LICENSE" href="copyright.html" />
    <link rel="prev" title="Welcome to measpy’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            measpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Readme</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#todo">TODO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-example">Usage example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_signals_tutorial.html">Signal tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_spectral_data.html">Spectral tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_measurements.html">Measurement tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_spectrum_smoothing_and_weighting.html">Weighting and smoothing tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="measpy.html">measpy package</a></li>
</ul>

    <a href="genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">measpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">measpy - Measurements with Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="measpy-measurements-with-python">
<h1>measpy - Measurements with Python<a class="headerlink" href="#measpy-measurements-with-python" title="Permalink to this heading"></a></h1>
<p>(c) 2021-2023 Olivier Doaré
Contact: olivier.doare&#64;ensta-paris.fr</p>
<p>measpy is a set of classes and methods that serves these two main purposes:</p>
<ul class="simple">
<li><p>Allow signal processing and analysis using rapid and compact Python scripting, thanks to the functional programming paradigm proposed by this package</p></li>
<li><p>Data acquisition with DAQ cards</p></li>
</ul>
<p>The base classes defined by <code class="docutils literal notranslate"><span class="pre">measpy</span></code> are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Signal</span></code>: This is the core class of the package. It defines a signal through a sampling frequency, a physical unit and a list of samples and a description. Additional properties can be defined in order to take into account calibration or time shifting of the signal with respect to a reference time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Spectral</span></code>: This class represents the signals in the Fourier space. A spectral object contains the complex amplitudes as a 1D numpy array for frequencies up to the Nyquist frequency or the sampling frequency, and some properties as sampling frequency, unit and description.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Measurement</span></code> : A class that describe a data acquisition process, its outputs (Signal objects), its inputs (Signal objects)…</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Weighting</span></code> : A weighting class holds complex values for a list of frequencies, and methods to to smoothing, interpolation, etc.</p></li>
</ul>
<p>For now, data acquisition with these daq devices are implemented :</p>
<ul class="simple">
<li><p>Audio cards, via the <code class="docutils literal notranslate"><span class="pre">sounddevice</span></code> package,</p></li>
<li><p>NI DAQ cards, via the <code class="docutils literal notranslate"><span class="pre">nidaqmx</span></code> package.</p></li>
<li><p>Picoscope scopes, via the <code class="docutils literal notranslate"><span class="pre">picosdk-python-wrappers</span></code> package.</p></li>
</ul>
<p>To import the package and perform data acquisition with sound cards:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">measpy</span> <span class="k">as</span> <span class="nn">mp</span>
</pre></div>
</div>
<p>This will import the classes <code class="docutils literal notranslate"><span class="pre">mp.Measurement</span></code>, <code class="docutils literal notranslate"><span class="pre">mp.Signal</span></code>, <code class="docutils literal notranslate"><span class="pre">mp.Spectral</span></code> and <code class="docutils literal notranslate"><span class="pre">mp.Weighting</span></code>.</p>
<p>To do data acquisition one has to select the module that corresponds to the target device. If it is a soundcard:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.audio</span> <span class="kn">import</span> <span class="n">audio_run_measurement</span>
</pre></div>
</div>
<p>If it is a NI daq card:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.ni</span> <span class="kn">import</span> <span class="n">ni_run_measurement</span>
</pre></div>
</div>
<p>If it is a Picoscope of the ps2000 series:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.ps2000</span> <span class="kn">import</span> <span class="n">ps2000_run_measurement</span>
</pre></div>
</div>
<p>If it is a Picoscope of the ps4000 series:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.ps4000</span> <span class="kn">import</span> <span class="n">ps4000_run_measurement</span>
</pre></div>
</div>
<p>In theses modules, there’s also the <code class="docutils literal notranslate"><span class="pre">audio_get_devices</span></code> and <code class="docutils literal notranslate"><span class="pre">ni_get_devices</span></code> functions to get a list of devices present in the system. To get the list of devices, do for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">measpy.audio</span> <span class="kn">import</span> <span class="n">audio_get_devices</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">audio_get_devices</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
<section id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Permalink to this heading"></a></h2>
<p>Things to improve, implement, fix:</p>
<ul class="simple">
<li><p>A few scipy.signal functions are wrapped in measpy methods. New processing methods could be implemented (e.g. FIR…)</p></li>
<li><p>Improve plotting methods</p></li>
<li><p>Other In/Out synchronization methods (for now a method using a peak sync before measurement is implemented)</p></li>
<li><p>hdf5 file format</p></li>
<li><p>More documentation</p></li>
<li><p>More testing scripts</p></li>
<li><p>GUI ?</p></li>
</ul>
</section>
<section id="usage-example">
<h2>Usage example<a class="headerlink" href="#usage-example" title="Permalink to this heading"></a></h2>
<p>Consider the following experiment in which we want to record a pressure and an acceleration while we send a white noise at the sound card output (typical sound and vibration transfer function measurement):</p>
<ul class="simple">
<li><p>a white noise between 20Hz and 20kHz is sent to output 1 of the soundcard</p></li>
<li><p>a pressure is acquired at input 1 (Unit pascals)</p></li>
<li><p>an acceleration is acquired at input 2 (unit m/s^2)</p></li>
<li><p>the sampling frequency is 44100Hz</p></li>
<li><p>the calibration of signal conditionners are : 1V/pascal, 0.1V/(m/s^2)</p></li>
<li><p>the soundcard input gain is such that for 5V at its inputs, the sample amplitude is 1.0 (input or output). This value is referred to as 0dB full scale (0dBFS)</p></li>
<li><p>the duration of the measurement is 5s</p></li>
<li><p>the soundcard name is ‘My card’, as given by measpy.audio.audio_get_devices()</p></li>
</ul>
<p>To setup and run the measurement, do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">measpy</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">measpy.audio</span> <span class="kn">import</span> <span class="n">audio_run_measurement</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">M1</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Measurement</span><span class="p">(</span><span class="n">out_sig</span><span class="o">=</span><span class="s1">&#39;noise&#39;</span><span class="p">,</span>
                    <span class="n">out_map</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">out_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Out1&#39;</span><span class="p">],</span>
                    <span class="n">out_desc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Output noise&#39;</span><span class="p">],</span>
                    <span class="n">out_sig_freqs</span><span class="o">=</span><span class="p">[</span><span class="mf">20.0</span><span class="p">,</span><span class="mf">20000.0</span><span class="p">]</span>
                    <span class="n">in_map</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">in_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">,</span><span class="s1">&#39;Acc&#39;</span><span class="p">]</span>
                    <span class="n">in_desc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pressure at point A&#39;</span><span class="p">,</span><span class="s1">&#39;Acceleration at point B&#39;</span><span class="p">],</span>
                    <span class="n">in_cal</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">],</span>
                    <span class="n">in_unit</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pa&#39;</span><span class="p">,</span><span class="s1">&#39;m/s**2&#39;</span><span class="p">],</span>
                    <span class="n">in_dbfs</span><span class="o">=</span><span class="p">[</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">],</span>
                    <span class="n">out_dbfs</span><span class="o">=</span><span class="p">[</span><span class="mf">5.0</span><span class="p">,]</span>
                    <span class="n">dur</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                    <span class="n">in_device</span><span class="o">=</span><span class="s1">&#39;My card&#39;</span><span class="p">,</span>
                    <span class="n">out_device</span><span class="o">=</span><span class="s1">&#39;My card&#39;</span><span class="p">)</span>
<span class="n">audio_run_measurement</span><span class="p">(</span><span class="n">M1</span><span class="p">)</span>
</pre></div>
</div>
<p>To plot the resulting data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>It is possible to save measurements in different formats. For instance, this saves the data as a pair of ‘file.csv’ + ‘file.wav’ files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span><span class="o">.</span><span class="n">to_csvwav</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The CSV file then contains the measurement properties while the WAV file contains the actual data that has been acquired (as many channel as the number of inputs+outputs involved in the measurement)</p>
<p>Load a measurement file into the Measurement object M2:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">from_csvwav</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Other formats are possible : A pickle file, or a json+wave files. See from_pickle() or from_jsonwav() methods.</p>
<p>Compute transfer functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span> <span class="o">=</span> <span class="n">M1</span><span class="o">.</span><span class="n">tfe</span><span class="p">()</span>
</pre></div>
</div>
<p>This computes the transfer function between the output signal and all the input signals as a dict of <code class="docutils literal notranslate"><span class="pre">Spectral</span></code> objects. The method that is actually used depends on the output type, as specified in the out_sig property of the measurement object. If a ‘noise’ or ‘*wav’ type signal is sent, Welch’s method is used. If a ‘logsweep’ type is used, Farina’s method is used. This basic helper function works only if there is a unique output.</p>
<p>In general is is preferable to work on individual signals. All the acquired and sent signals are stored into the data property. It is basically a dict of signals, the keys being set by the in_name and out_name arguments when measurement is called. If these optional argument where not specified, then the keys are named by default In1, In2, … and Out1, Out2, …</p>
<p>For example, to plot only the measured pressure we can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span><span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>If no arguments are given, the <code class="docutils literal notranslate"><span class="pre">plot</span></code> method of signal objects creates a new figure, draw the signal with the correct dimension and put the correct labels on all axes. This methods returns an axes object that can be used later to plot new signals on the same figure.</p>
<p>One may want to calculate the power spectral density of the pressure (Welch’s method on 2**12 points, 50% overlaping):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PressPSD</span> <span class="o">=</span> <span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span><span class="n">nperseg</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PressPSD</span></code> is now a <code class="docutils literal notranslate"><span class="pre">Spectral</span></code> class object. It has its own methods. For instance, to plot the data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PressPSD</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>You might want to compute the transfer function between <code class="docutils literal notranslate"><span class="pre">M1.data['Acc']</span></code> and <code class="docutils literal notranslate"><span class="pre">M1.data['Press']</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tfap</span> <span class="o">=</span> <span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Acc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tfe_welch</span><span class="p">(</span><span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">],</span><span class="n">nperseg</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>And use this <code class="docutils literal notranslate"><span class="pre">Spectral</span></code> object to compute an impulse response:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Gap</span> <span class="o">=</span> <span class="n">tfap</span><span class="o">.</span><span class="n">irfft</span><span class="p">()</span>
</pre></div>
</div>
<p>This could be done in one step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Gap</span> <span class="o">=</span> <span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Acc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tfe_welch</span><span class="p">(</span><span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">],</span><span class="n">nperseg</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">irfft</span><span class="p">()</span>
</pre></div>
</div>
<p>To remove frequencies below 20Hz and above 20kHz before computing the impulse:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Gap</span> <span class="o">=</span> <span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Acc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tfe_welch</span><span class="p">(</span><span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">],</span><span class="n">nperseg</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">filterout</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">20000</span><span class="p">])</span><span class="o">.</span><span class="n">irfft</span><span class="p">()</span>
</pre></div>
</div>
<p>Units are preserved during the operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Gap</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</pre></div>
</div>
<p>should give something like pascal * second**2 / m</p>
<p>Individual signals can also be saved as a pair of files: a .csv containing the metadata informations of the signal (sampling frequency, calibration informations, name…), and a .wav file, containing the actual data (dimensionless):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Press&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csvwav</span><span class="p">(</span><span class="s1">&#39;Pressure&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will create Pressure.csv and Pressure.wav, that can be reloaded later with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">press_sig</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Signal</span><span class="o">.</span><span class="n">from_csvwav</span><span class="p">(</span><span class="s1">&#39;Pressure&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to measpy’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="copyright.html" class="btn btn-neutral float-right" title="GNU LESSER GENERAL PUBLIC LICENSE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="copyright.html">Copyright</a> 2021, Olivier Doaré.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>